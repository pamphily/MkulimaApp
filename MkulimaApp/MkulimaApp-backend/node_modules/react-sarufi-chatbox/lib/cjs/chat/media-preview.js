"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.downloadFile = void 0;
var react_1 = __importStar(require("react"));
var modal_1 = __importDefault(require("./modal"));
var audio_1 = __importDefault(require("./audio"));
var video_1 = __importDefault(require("./video"));
var image_1 = __importDefault(require("./image"));
var icons_1 = require("../assets/icons");
var chatbox_1 = require("./chatbox");
require("../style.css");
require("./media.css");
var MediaPreview = function (_a) {
    var type = _a.type, _b = _a.url, url = _b === void 0 ? "" : _b, _c = _a.caption, caption = _c === void 0 ? "" : _c, mode = _a.mode, fontFamily = _a.fontFamily, fontSize = _a.fontSize, index = _a.index, chat = _a.chat, mediaId = _a.mediaId, location = _a.location, showArrow = _a.showArrow, style = _a.style;
    var _d = (0, react_1.useState)(false), fullScreen = _d[0], setFullScreen = _d[1];
    var order = [
        "images",
        "stickers",
        "videos",
        "audios",
        "documents",
        "locations",
    ];
    var findIndex = order.findIndex(function (item) { return item === type; });
    var findAboveIndex = order.findIndex(function (item) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
        if (item === "images" &&
            ((_c = (_b = (_a = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _a === void 0 ? void 0 : _a.find(function (action) { return action.send_images; })) === null || _b === void 0 ? void 0 : _b.send_images) === null || _c === void 0 ? void 0 : _c.length) > 0) {
            return true;
        }
        else if (item === "stickers" &&
            ((_f = (_e = (_d = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _d === void 0 ? void 0 : _d.find(function (action) { return action.send_stickers; })) === null || _e === void 0 ? void 0 : _e.send_stickers) === null || _f === void 0 ? void 0 : _f.length) > 0) {
            return true;
        }
        else if (item === "audios" &&
            ((_j = (_h = (_g = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _g === void 0 ? void 0 : _g.find(function (action) { return action.send_audios; })) === null || _h === void 0 ? void 0 : _h.send_audios) === null || _j === void 0 ? void 0 : _j.length) > 0) {
            return true;
        }
        else if (item === "videos" &&
            ((_m = (_l = (_k = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _k === void 0 ? void 0 : _k.find(function (action) { return action.send_videos; })) === null || _l === void 0 ? void 0 : _l.send_videos) === null || _m === void 0 ? void 0 : _m.length) > 0) {
            return true;
        }
        else if (item === "documents" &&
            ((_q = (_p = (_o = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _o === void 0 ? void 0 : _o.find(function (action) { return action.send_documents; })) === null || _p === void 0 ? void 0 : _p.send_documents) === null || _q === void 0 ? void 0 : _q.length) > 0) {
            return true;
        }
        else {
            return false;
        }
    });
    return (react_1.default.createElement("div", { className: "sarufi-media-preview sarufi-message-body ".concat((findIndex <= findAboveIndex && !index) || showArrow
            ? "sarufi-message-body-w-arrow"
            : ""), style: __assign({ background: "var(--sarufi-received-box-bg)", maxWidth: 280, padding: "6px 8px 8px 9px", marginTop: findIndex <= findAboveIndex && !index ? ".7rem" : "0", marginBottom: ".3rem", position: "relative", borderTopLeftRadius: findIndex <= findAboveIndex ? "7.5px" : "0", borderTopRightRadius: findIndex <= findAboveIndex ? "7.5px" : "0" }, style) },
        react_1.default.createElement(react_1.default.Fragment, null,
            (type === "images" || type === "stickers") && (react_1.default.createElement(image_1.default, { url: url, caption: caption, openFullScreen: function () { return setFullScreen(true); }, isFullScreen: false, fontFamily: fontFamily, fontSize: fontSize })),
            type === "audios" && (react_1.default.createElement("div", { style: {
                    background: mode === "dark" ? "rgba(255, 255, 255, .1)" : "rgba(0,0,0,.1)",
                    borderRadius: ".3rem",
                    padding: ".1rem .5rem",
                } },
                react_1.default.createElement(audio_1.default, { url: url, fontSize: fontSize, mode: mode, mediaId: mediaId }))),
            type === "videos" && (react_1.default.createElement(video_1.default, { url: url, caption: caption, fontFamily: fontFamily, fontSize: fontSize, mediaId: mediaId, mode: mode })),
            type === "documents" && (react_1.default.createElement("div", { style: {
                    background: mode === "dark" ? "rgba(255, 255, 255, .1)" : "rgba(0,0,0,.1)",
                    borderRadius: ".3rem",
                    padding: ".1rem .5rem",
                } },
                react_1.default.createElement(DocumentPreview, { url: url }))),
            type === "locations" && (react_1.default.createElement("div", { style: {
                    margin: ".5rem",
                } },
                react_1.default.createElement("div", { style: {
                        marginBottom: ".4rem",
                    } }, "Location:"),
                react_1.default.createElement("div", null,
                    (location === null || location === void 0 ? void 0 : location.latitude) && (react_1.default.createElement("div", null,
                        react_1.default.createElement("p", { style: {
                            // marginTop: ".2rem",
                            } },
                            react_1.default.createElement("span", { style: {
                                    opacity: 0.7,
                                } }, "Latitude:"),
                            " ", location === null || location === void 0 ? void 0 :
                            location.latitude))),
                    (location === null || location === void 0 ? void 0 : location.longitude) && (react_1.default.createElement("div", null,
                        react_1.default.createElement("p", { style: {
                                marginTop: ".2rem",
                            } },
                            react_1.default.createElement("span", { style: {
                                    opacity: 0.7,
                                } }, "Longitude:"),
                            " ", location === null || location === void 0 ? void 0 :
                            location.longitude))),
                    (location === null || location === void 0 ? void 0 : location.name) && (react_1.default.createElement("div", null,
                        react_1.default.createElement("p", { style: {
                                marginTop: ".2rem",
                            } },
                            react_1.default.createElement("span", { style: {
                                    opacity: 0.7,
                                } }, "Name:"),
                            " ", location === null || location === void 0 ? void 0 :
                            location.name))),
                    (location === null || location === void 0 ? void 0 : location.address) && (react_1.default.createElement("div", null,
                        react_1.default.createElement("p", { style: {
                                marginTop: ".2rem",
                            } },
                            react_1.default.createElement("span", { style: {
                                    opacity: 0.7,
                                } }, "Address:"),
                            " ", location === null || location === void 0 ? void 0 :
                            location.address))))))),
        react_1.default.createElement(modal_1.default, { close: function () { return setFullScreen(false); }, open: fullScreen, closeWithBackdrop: true, mode: mode },
            react_1.default.createElement(react_1.default.Fragment, null, (type === "images" || type === "stickers") && (react_1.default.createElement(image_1.default, { url: url, caption: caption, openFullScreen: function () { return setFullScreen(true); }, isFullScreen: fullScreen, fontFamily: fontFamily, fontSize: fontSize })))),
        caption && (react_1.default.createElement("p", { style: {
                margin: ".5rem 0 .7rem",
                color: "var(--sarufi-received-box-color)",
                fontFamily: "var(--sarufi-font-family)",
            } }, (0, chatbox_1.wrap)((0, chatbox_1.wrapUrl)(caption))))));
};
exports.default = MediaPreview;
var DocumentPreview = function (_a) {
    var url = _a.url;
    return (react_1.default.createElement("div", { style: {
            margin: ".5rem .5rem .5rem 0rem",
        }, className: "sarufi-flex-wide" },
        react_1.default.createElement("div", { style: {
                width: "calc( 100% - 50px )",
                transform: "scale(0.9)",
            } },
            react_1.default.createElement("span", { className: "sarufi-flex-start", style: {
                    width: "100%",
                    overflow: "hidden",
                    display: "-webkit-box",
                    WebkitLineClamp: 3,
                    WebkitBoxOrient: "vertical",
                } },
                react_1.default.createElement("span", null, url))),
        react_1.default.createElement("button", { style: {
                background: "none",
                border: "none",
                cursor: "pointer",
                color: "var(--sent-box-text-color)",
            }, className: "sarufi-button", onClick: function () { return downloadFile(url); } },
            react_1.default.createElement(icons_1.DownloadIcon, null))));
};
function downloadFile(url) {
    var aTag = document.createElement("a");
    aTag.href = url;
    aTag.download = "sarufi_document";
    aTag.download = url.replace(/^.*[\\\/]/, "");
    document.body.appendChild(aTag);
    aTag.click();
    aTag.remove();
}
exports.downloadFile = downloadFile;
