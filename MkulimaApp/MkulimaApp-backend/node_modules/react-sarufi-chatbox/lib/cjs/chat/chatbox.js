"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.wrap = exports.wrapUrl = void 0;
var react_1 = __importDefault(require("react"));
var axios_1 = __importDefault(require("axios"));
var react_2 = require("react");
// Local imports
var button_1 = __importDefault(require("./button"));
var input_1 = __importDefault(require("./input"));
var chat_loader_1 = __importDefault(require("./chat-loader"));
var icons_1 = require("../assets/icons");
var illustrations_1 = require("../assets/illustrations");
var media_1 = __importDefault(require("./media"));
var date_picker_1 = __importDefault(require("./message-actions/date-picker"));
var Chatbox = function (_a) {
    var id = _a.id, open = _a.open, botId = _a.botId, API_URL = _a.API_URL, mode = _a.mode, primaryColor = _a.primaryColor, token = _a.token, fontFamily = _a.fontFamily, fontSize = _a.fontSize;
    var _b = (0, react_2.useState)([]), chats = _b[0], setChats = _b[1];
    var _c = (0, react_2.useState)(""), value = _c[0], setValue = _c[1];
    var _d = (0, react_2.useState)(false), loading = _d[0], setLoading = _d[1];
    var ref = (0, react_2.useRef)(null);
    var _e = (0, react_2.useState)(id), chatId = _e[0], setChatId = _e[1];
    var isRecording = (0, react_2.useState)(false)[0];
    var onSubmit = function (message, type, itemId) {
        if (!message)
            return;
        setChats(function (prev) {
            return __spreadArray(__spreadArray([], prev, true), [{ message: message, sent: true }], false);
        });
        setValue("");
        setLoading(true);
        axios_1.default
            .post("".concat(API_URL).concat(token ? "/conversation/whatsapp" : "/plugin/conversation/" + botId), {
            message: itemId !== null && itemId !== void 0 ? itemId : message,
            chat_id: chatId,
            bot_id: botId,
            message_type: type !== null && type !== void 0 ? type : "text",
        }, {
            headers: __assign({ "Content-Type": "application/json" }, (token ? { Authorization: "Bearer " + token } : {})),
        })
            .then(function (data) {
            setChats(function (prev) {
                var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z;
                return __spreadArray(__spreadArray([], prev, true), [
                    {
                        message: typeof ((_a = data === null || data === void 0 ? void 0 : data.data) === null || _a === void 0 ? void 0 : _a.actions) === "object" &&
                            ((_d = (_c = (_b = data === null || data === void 0 ? void 0 : data.data) === null || _b === void 0 ? void 0 : _b.actions) === null || _c === void 0 ? void 0 : _c.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_message; })) === null || _d === void 0 ? void 0 : _d.send_message)
                            ? (_g = (_f = (_e = data === null || data === void 0 ? void 0 : data.data) === null || _e === void 0 ? void 0 : _e.actions) === null || _f === void 0 ? void 0 : _f.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_message; })) === null || _g === void 0 ? void 0 : _g.send_message
                            : typeof ((_h = data === null || data === void 0 ? void 0 : data.data) === null || _h === void 0 ? void 0 : _h.message) === "string"
                                ? (_j = data === null || data === void 0 ? void 0 : data.data) === null || _j === void 0 ? void 0 : _j.message
                                : ((_l = (_k = data === null || data === void 0 ? void 0 : data.data) === null || _k === void 0 ? void 0 : _k.response) === null || _l === void 0 ? void 0 : _l.find(function (item) { return Object.keys(item)[0] === "send_message"; }))
                                    ? (_q = (_p = (_o = (_m = data === null || data === void 0 ? void 0 : data.data) === null || _m === void 0 ? void 0 : _m.response) === null || _o === void 0 ? void 0 : _o.find(function (item) { return Object.keys(item)[0] === "send_message"; })) === null || _p === void 0 ? void 0 : _p.send_message) === null || _q === void 0 ? void 0 : _q.join("\n")
                                    : (_s = (_r = data === null || data === void 0 ? void 0 : data.data) === null || _r === void 0 ? void 0 : _r.message) === null || _s === void 0 ? void 0 : _s.join("\n"),
                        received: true,
                        chat: data === null || data === void 0 ? void 0 : data.data,
                        type: ((_t = data === null || data === void 0 ? void 0 : data.data) === null || _t === void 0 ? void 0 : _t.actions)
                            ? (_x = (_w = (_v = (_u = data === null || data === void 0 ? void 0 : data.data) === null || _u === void 0 ? void 0 : _u.actions) === null || _v === void 0 ? void 0 : _v.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _w === void 0 ? void 0 : _w.send_reply_button) === null || _x === void 0 ? void 0 : _x.type
                            : "",
                        actions: (_y = data === null || data === void 0 ? void 0 : data.data) === null || _y === void 0 ? void 0 : _y.actions,
                        next_state: (_z = data === null || data === void 0 ? void 0 : data.data) === null || _z === void 0 ? void 0 : _z.next_state,
                    },
                ], false);
            });
            setLoading(false);
        })
            .catch(function (error) {
            // show error as a chat / a pospup within an app
            setChats(function (prev) {
                var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o;
                return __spreadArray(__spreadArray([], prev, true), [
                    {
                        message: typeof ((_b = (_a = error === null || error === void 0 ? void 0 : error.response) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b.detail) === "string"
                            ? (_d = (_c = error === null || error === void 0 ? void 0 : error.response) === null || _c === void 0 ? void 0 : _c.data) === null || _d === void 0 ? void 0 : _d.detail
                            : typeof ((_f = (_e = error === null || error === void 0 ? void 0 : error.response) === null || _e === void 0 ? void 0 : _e.data) === null || _f === void 0 ? void 0 : _f.detail) === "object"
                                ? (_j = (_h = (_g = error === null || error === void 0 ? void 0 : error.response) === null || _g === void 0 ? void 0 : _g.data) === null || _h === void 0 ? void 0 : _h.detail[0]) === null || _j === void 0 ? void 0 : _j.msg
                                : typeof ((_l = (_k = error === null || error === void 0 ? void 0 : error.response) === null || _k === void 0 ? void 0 : _k.data) === null || _l === void 0 ? void 0 : _l.message) === "string"
                                    ? (_o = (_m = error === null || error === void 0 ? void 0 : error.response) === null || _m === void 0 ? void 0 : _m.data) === null || _o === void 0 ? void 0 : _o.message
                                    : error === null || error === void 0 ? void 0 : error.message,
                    },
                ], false);
            });
            setLoading(false);
        });
    };
    (0, react_2.useEffect)(function () {
        var _a;
        if (ref.current)
            ref.current.scrollTop =
                ((_a = ref.current) === null || _a === void 0 ? void 0 : _a.scrollHeight) - ref.current.clientHeight;
    }, [chats]);
    (0, react_2.useEffect)(function () {
        if (chatId !== id) {
            setChatId(id);
            setChats([]);
            setValue("");
        }
    }, [open]);
    return (react_1.default.createElement(react_1.default.Fragment, null,
        react_1.default.createElement("div", { ref: ref, id: "sarufi-chat-container", style: {
                background: "var(--sarufi-chatbox-bg)",
                height: "calc( 100% - 160px )",
                // height: "100%",
                overflowY: "auto",
                display: "flex",
                flexDirection: "column",
                justifyContent: "space-between",
            }, className: "sarufi-scroll-bar" },
            react_1.default.createElement("div", { style: {
                    position: "relative",
                    padding: "1rem",
                } },
                react_1.default.createElement("div", { className: "sarufi-message-body", style: {
                        maxWidth: 280,
                        background: "var(--sarufi-received-box-bg)",
                        padding: "6px 8px 8px 9px",
                        marginTop: ".7rem",
                        position: "relative",
                        borderRadius: ".3rem",
                    } },
                    react_1.default.createElement("p", { style: {
                            fontFamily: "var(--sarufi-font-family)",
                        } }, "Send a message to initiate conversation i.e \"Hello\"")),
                react_1.default.createElement("ul", null, chats === null || chats === void 0 ? void 0 :
                    chats.map(function (chat, index) { return (react_1.default.createElement(Chat, { chat: chat, key: index, onSubmit: onSubmit, primaryColor: primaryColor, mode: mode, fontFamily: fontFamily, fontSize: fontSize, index: index })); }),
                    loading && (react_1.default.createElement("div", { className: "sarufi-message-body", style: {
                            background: "var(--sarufi-received-box-bg)",
                            padding: "6px 8px 8px 9px",
                            marginTop: ".7rem",
                            position: "relative",
                            borderRadius: ".3rem",
                            maxWidth: 100,
                        } },
                        react_1.default.createElement(chat_loader_1.default, null)))))),
        react_1.default.createElement("div", { className: "sarufi-flex-wide", style: {
                background: "var(--sarufi-secondary-color)",
                // background: "rgb(0, 0, 0, 0.2)",
                padding: ".5rem",
            } },
            !isRecording && (react_1.default.createElement("form", { style: {
                    position: "relative",
                    marginRight: ".5rem",
                    width: "100%",
                    background: mode === "light" ? "white" : "var(--sarufi-primary-color)",
                }, onSubmit: function (e) {
                    e.preventDefault();
                    onSubmit(value);
                } },
                react_1.default.createElement(input_1.default, { value: value, mode: mode, primaryColor: primaryColor, autoFocus: true, placeholder: "Compose a message", save: function () { return onSubmit(value); }, onChange: function (e) {
                        setValue(e.target.value);
                    } }),
                react_1.default.createElement(button_1.default, { mode: mode, label: react_1.default.createElement("span", { className: "sarufi-flex-center" },
                        react_1.default.createElement(icons_1.SendIcon, { size: 24 })) }))),
            react_1.default.createElement("div", { className: "sarufi-flex-center message-actions", style: {
                    color: mode === "light" ? "#525252" : "white",
                    width: isRecording ? "100%" : "auto",
                } }, !isRecording && (react_1.default.createElement(react_1.default.Fragment, null,
                react_1.default.createElement(date_picker_1.default, { onSelect: function (d) {
                        return setValue("".concat(d.getDate(), "/").concat(d.getMonth() + 1, "/").concat(d.getFullYear()));
                    }, styles: {
                        margin: "0 .3rem",
                    } }))))),
        react_1.default.createElement("p", { style: {
                fontSize: ".7rem",
                textAlign: "center",
                padding: "5px 0",
                color: mode === "dark" ? "white" : "",
                background: mode === "light" ? "white" : "var(--sarufi-primary-color)",
            } },
            "Powered by",
            " ",
            react_1.default.createElement("a", { href: "https://sarufi.io", target: "_blank", style: {
                    textDecoration: "none",
                    fontWeight: "700",
                    color: "#2776EA",
                } }, "Sarufi"))));
};
exports.default = Chatbox;
var Chat = function (_a) {
    var _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18;
    var chat = _a.chat, onSubmit = _a.onSubmit, mode = _a.mode, fontFamily = _a.fontFamily, fontSize = _a.fontSize, index = _a.index, primaryColor = _a.primaryColor;
    var message = (chat === null || chat === void 0 ? void 0 : chat.type) === "button"
        ? (_e = (_d = (_c = (_b = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _b === void 0 ? void 0 : _b.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _c === void 0 ? void 0 : _c.send_reply_button) === null || _d === void 0 ? void 0 : _d.body) === null || _e === void 0 ? void 0 : _e.text
        : chat === null || chat === void 0 ? void 0 : chat.message;
    var menu = (_f = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _f === void 0 ? void 0 : _f.find(function (e) { return Object.keys(e)[0] === "send_button"; });
    var _19 = (0, react_2.useState)(false), openChoices = _19[0], setOpenChoices = _19[1];
    (0, react_2.useEffect)(function () {
        var container = document.getElementById("sarufi-chat-container");
        if (openChoices && container) {
            container.style.overflowY = "hidden";
        }
        if (!openChoices && container) {
            container.style.overflowY = "auto";
        }
    }, [openChoices]);
    // listen to escape keyboard event
    var keydown = function (e) {
        if (e.key === "Escape")
            return setOpenChoices(false);
    };
    (0, react_2.useEffect)(function () {
        document.addEventListener("keydown", keydown, false);
        return function () {
            document.removeEventListener("keydown", keydown, false);
        };
    }, []);
    var hasMedia = false; // checks if media are present
    if ((_g = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _g === void 0 ? void 0 : _g.find(function (action) {
        return ((action.send_audios && action.send_audios.length > 0) ||
            (action.send_images && action.send_images.length > 0) ||
            (action.send_videos && action.send_videos.length > 0) ||
            (action.send_documents && action.send_documents.length > 0) ||
            (action.send_stickers && action.send_stickers.length > 0) ||
            (action.send_locations && action.send_locations.length > 0));
    }))
        hasMedia = true;
    return (react_1.default.createElement("li", { className: "".concat((chat === null || chat === void 0 ? void 0 : chat.sent) ? "sarufi-flex-end" : ""), style: {
            position: "relative",
            display: "flex",
            alignItems: "flex-end",
        } },
        !(chat === null || chat === void 0 ? void 0 : chat.sent) && (react_1.default.createElement("div", { style: {
                marginRight: "5px",
            } },
            react_1.default.createElement(illustrations_1.SarufiIcon, { size: 20, style: {
                    color: primaryColor,
                } }))),
        react_1.default.createElement("div", null,
            react_1.default.createElement(media_1.default, { chat: chat, mode: mode, fontFamily: fontFamily, fontSize: fontSize, messageIndex: index }),
            react_1.default.createElement("div", { className: "sarufi-message-body  ".concat((chat === null || chat === void 0 ? void 0 : chat.sent) ? "sent" : ""), style: __assign({ background: (chat === null || chat === void 0 ? void 0 : chat.sent)
                        ? "var(--sarufi-sent-box-bg)"
                        : "var(--sarufi-received-box-bg)", maxWidth: 280, width: hasMedia ? "100%" : "max-content", minWidth: "50px", padding: "6px 8px 8px 9px", marginTop: hasMedia ? "0" : "12px", position: "relative", borderRadius: ((_m = (_l = (_k = (_j = (_h = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _h === void 0 ? void 0 : _h.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _j === void 0 ? void 0 : _j.send_reply_button) === null || _k === void 0 ? void 0 : _k.action) === null || _l === void 0 ? void 0 : _l.buttons) === null || _m === void 0 ? void 0 : _m.length) > 0 ||
                        ((!message || typeof message !== "string") &&
                            (chat === null || chat === void 0 ? void 0 : chat.actions) &&
                            menu)
                        ? "0rem"
                        : ".3rem" }, (!hasMedia && !(chat === null || chat === void 0 ? void 0 : chat.sent)
                    ? { borderTopRightRadius: ".3rem" }
                    : {})) },
                (!message || typeof message !== "string") &&
                    (chat === null || chat === void 0 ? void 0 : chat.actions) &&
                    menu && (react_1.default.createElement(react_1.default.Fragment, null,
                    ((_o = menu["send_button"]) === null || _o === void 0 ? void 0 : _o.header) && (react_1.default.createElement(Message, { message: (_p = menu["send_button"]) === null || _p === void 0 ? void 0 : _p.header, style: {
                            marginBottom: "1rem",
                        } })),
                    ((_q = menu["send_button"]) === null || _q === void 0 ? void 0 : _q.body) && (react_1.default.createElement(Message, { message: (_r = menu["send_button"]) === null || _r === void 0 ? void 0 : _r.body })),
                    ((_s = menu["send_button"]) === null || _s === void 0 ? void 0 : _s.footer) && (react_1.default.createElement(Message, { message: (_t = menu["send_button"]) === null || _t === void 0 ? void 0 : _t.footer, style: {
                            marginTop: "1rem",
                            fontSize: ".9em",
                            opacity: 0.7,
                        } })))),
                ((chat === null || chat === void 0 ? void 0 : chat.type) || message) && !menu && (react_1.default.createElement(Message, { message: typeof message === "string" ? message : message === null || message === void 0 ? void 0 : message.join("\n") }))),
            (chat === null || chat === void 0 ? void 0 : chat.type) === "button" && (react_1.default.createElement("ul", { className: "sarufi-flex-wide sarufi-flex-wrap", style: {
                    maxWidth: 280,
                } }, (_y = (_x = (_w = (_v = (_u = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _u === void 0 ? void 0 : _u.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _v === void 0 ? void 0 : _v.send_reply_button) === null || _w === void 0 ? void 0 : _w.action) === null || _x === void 0 ? void 0 : _x.buttons) === null || _y === void 0 ? void 0 : _y.map(function (el, i) {
                var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
                return (react_1.default.createElement("li", { style: {
                        width: "100%",
                        marginTop: "2px",
                        background: "var(--sarufi-received-box-bg)",
                        borderBottomLeftRadius: i ===
                            ((_e = (_d = (_c = (_b = (_a = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _a === void 0 ? void 0 : _a.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _b === void 0 ? void 0 : _b.send_reply_button) === null || _c === void 0 ? void 0 : _c.action) === null || _d === void 0 ? void 0 : _d.buttons) === null || _e === void 0 ? void 0 : _e.length) -
                                1
                            ? ".3rem"
                            : "0",
                        borderBottomRightRadius: i ===
                            ((_k = (_j = (_h = (_g = (_f = chat === null || chat === void 0 ? void 0 : chat.actions) === null || _f === void 0 ? void 0 : _f.find(function (action) { return action === null || action === void 0 ? void 0 : action.send_reply_button; })) === null || _g === void 0 ? void 0 : _g.send_reply_button) === null || _h === void 0 ? void 0 : _h.action) === null || _j === void 0 ? void 0 : _j.buttons) === null || _k === void 0 ? void 0 : _k.length) -
                                1
                            ? ".3rem"
                            : "0",
                    }, key: i },
                    react_1.default.createElement("button", { onClick: function () {
                            var _a, _b;
                            return onSubmit((_a = el === null || el === void 0 ? void 0 : el.reply) === null || _a === void 0 ? void 0 : _a.title, (chat === null || chat === void 0 ? void 0 : chat.type) !== "text" ? "interactive" : "text", (_b = el === null || el === void 0 ? void 0 : el.reply) === null || _b === void 0 ? void 0 : _b.id);
                        }, style: {
                            width: "100%",
                            height: "100%",
                            background: "none",
                            border: "none",
                            color: "var(--sarufi-received-box-link-color)",
                            cursor: "pointer",
                            fontSize: "inherit",
                            padding: "10px",
                            fontFamily: "var(--sarufi-font-family)",
                        }, className: "sarufi-flex-center sarufi-flex-wrap" }, (_l = el === null || el === void 0 ? void 0 : el.reply) === null || _l === void 0 ? void 0 : _l.title)));
            }))),
            (!message || typeof message !== "string") && (chat === null || chat === void 0 ? void 0 : chat.actions) && menu && (react_1.default.createElement("div", { className: "bg-neutral-0 sarufi-flex-center", style: {
                    maxWidth: 280,
                    marginTop: "2px",
                    background: "var(--sarufi-received-box-bg)",
                    borderBottomLeftRadius: ".3rem",
                    borderBottomRightRadius: ".3rem",
                } },
                react_1.default.createElement("button", { onClick: function () { return setOpenChoices(true); }, className: "link text-small-100 sarufi-flex-center cursor-pointer", style: {
                        width: "100%",
                        height: "100%",
                        background: "none",
                        border: "none",
                        color: "var(--sarufi-received-box-link-color)",
                        cursor: "pointer",
                        fontSize: "inherit",
                        padding: "10px",
                        fontFamily: "var(--sarufi-font-family)",
                    } }, (_0 = (_z = menu["send_button"]) === null || _z === void 0 ? void 0 : _z.button) !== null && _0 !== void 0 ? _0 : (_2 = (_1 = menu["send_button"]) === null || _1 === void 0 ? void 0 : _1.action) === null || _2 === void 0 ? void 0 : _2.button))),
            (!message || typeof message !== "string") &&
                (chat === null || chat === void 0 ? void 0 : chat.actions) &&
                menu &&
                openChoices && (react_1.default.createElement("div", { className: "choices", style: {
                    position: "fixed",
                    zIndex: 100004,
                    transition: "0.35s linear",
                } },
                react_1.default.createElement("div", { className: "sarufi-backdrop", style: {
                        position: "fixed",
                        background: "rgba(0, 0, 0, 0.6)",
                        zIndex: 100004,
                        transition: "0.35s linear",
                    }, onClick: function () { return setOpenChoices(false); } }),
                react_1.default.createElement("div", { className: "sarufi-options sarufi-scroll-bar", style: {
                        zIndex: 100005,
                        background: "var(--sarufi-received-box-bg)",
                        color: "var(--sarufi-received-box-color)",
                        borderRadius: ".3rem",
                    } },
                    react_1.default.createElement("div", { className: "sarufi-flex-start", style: {
                            padding: "1rem",
                            paddingBottom: ".5rem",
                            marginBottom: "1rem",
                        } },
                        react_1.default.createElement("button", { onClick: function () { return setOpenChoices(false); }, style: {
                                background: "none",
                                border: "none",
                                cursor: "pointer",
                                color: "var(--sarufi-received-box-color)",
                            }, className: "sarufi-button" },
                            react_1.default.createElement(icons_1.Close, { size: 18 })),
                        ((_5 = (_4 = (_3 = menu["send_button"]) === null || _3 === void 0 ? void 0 : _3.action) === null || _4 === void 0 ? void 0 : _4.sections[0]) === null || _5 === void 0 ? void 0 : _5.title) && (react_1.default.createElement("p", { style: {
                                width: "100%",
                                marginLeft: "1rem",
                                paddingRight: "2rem",
                                textAlign: "center",
                                fontFamily: "var(--sarufi-font-family)",
                            } }, (_8 = (_7 = (_6 = menu["send_button"]) === null || _6 === void 0 ? void 0 : _6.action) === null || _7 === void 0 ? void 0 : _7.sections[0]) === null || _8 === void 0 ? void 0 : _8.title))),
                    react_1.default.createElement("ul", { style: {
                            padding: "1rem",
                            paddingTop: "0",
                        } }, ((_13 = (_12 = (_11 = (_10 = (_9 = menu["send_button"]) === null || _9 === void 0 ? void 0 : _9.action) === null || _10 === void 0 ? void 0 : _10.sections[0]) === null || _11 === void 0 ? void 0 : _11.rows) === null || _12 === void 0 ? void 0 : _12.filter(function (el) { return el === null || el === void 0 ? void 0 : el.title; })) === null || _13 === void 0 ? void 0 : _13.length) > 0 &&
                        ((_18 = (_17 = (_16 = (_15 = (_14 = menu["send_button"]) === null || _14 === void 0 ? void 0 : _14.action) === null || _15 === void 0 ? void 0 : _15.sections[0]) === null || _16 === void 0 ? void 0 : _16.rows) === null || _17 === void 0 ? void 0 : _17.filter(function (el) { return el === null || el === void 0 ? void 0 : el.title; })) === null || _18 === void 0 ? void 0 : _18.map(function (row) { return (react_1.default.createElement("li", { className: "sarufi-flex-wide ", style: {
                                marginBottom: "1.5rem",
                                cursor: "pointer",
                            }, key: row === null || row === void 0 ? void 0 : row.title, onClick: function () {
                                onSubmit(row === null || row === void 0 ? void 0 : row.title, "interactive", row === null || row === void 0 ? void 0 : row.id);
                                setOpenChoices(false);
                            } },
                            react_1.default.createElement("div", null,
                                react_1.default.createElement("p", { className: "text-small-200", style: {
                                        fontFamily: "var(--sarufi-font-family)",
                                    } }, row === null || row === void 0 ? void 0 : row.title),
                                react_1.default.createElement("p", { style: {
                                        opacity: ".7",
                                        fontSize: ".9em",
                                        fontFamily: "var(--sarufi-font-family)",
                                    } }, row === null || row === void 0 ? void 0 : row.description)),
                            react_1.default.createElement("div", null,
                                react_1.default.createElement("span", { className: "sarufi-flex-center", style: {
                                        height: 15,
                                        width: 15,
                                        borderRadius: "50%",
                                        border: "1px solid var(--sarufi-received-box-color)",
                                        marginLeft: "1rem",
                                    } })))); })))))))));
};
var Message = function (_a) {
    var message = _a.message, className = _a.className, style = _a.style;
    return (react_1.default.createElement(react_1.default.Fragment, null, typeof message === "string" && (react_1.default.createElement("p", { style: __assign({ fontFamily: "var(--sarufi-font-family)", width: "100%" }, style), className: className !== null && className !== void 0 ? className : "", dangerouslySetInnerHTML: { __html: (0, exports.wrapUrl)((0, exports.wrap)(message)) } }))));
};
var wrapUrl = function (str) {
    var url_pattern = /(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;
    var strArr = [];
    var words = str.split(" ");
    words.forEach(function (word) {
        // split words by \n
        var newWords = word.split("\n");
        var newWordsArr = [];
        newWords.forEach(function (word) {
            if (!word.includes(".")) {
                return (newWordsArr = __spreadArray(__spreadArray([], newWordsArr, true), [word], false));
            }
            if (!url_pattern.test(word)) {
                return (newWordsArr = __spreadArray(__spreadArray([], newWordsArr, true), [word], false));
            }
            var protocol_pattern = /^(?:(?:https?|ftp):\/\/)/i;
            var href = protocol_pattern.test(word) ? word : "http://" + word;
            return (newWordsArr = __spreadArray(__spreadArray([], newWordsArr, true), [
                '<a href="' + href + '" target="_blank">' + word + "</a>",
            ], false));
        });
        strArr = __spreadArray(__spreadArray([], strArr, true), [newWordsArr.join("\n")], false);
    });
    return strArr.join(" ");
};
exports.wrapUrl = wrapUrl;
var wrap = function (str) {
    var _a, _b, _c;
    if (str && typeof str === "string") {
        return (_c = (_b = (_a = str === null || str === void 0 ? void 0 : str.replace(/(?:\*)([^*]*)(?:\*)/gm, "<strong>$1</strong> ")) === null || _a === void 0 ? void 0 : _a.replace(/(?:_)([^_]*)(?:_)/gm, "<i>$1</i> ")) === null || _b === void 0 ? void 0 : _b.replace(/(?:~)([^~]*)(?:~)/gm, "<strike>$1</strike> ")) === null || _c === void 0 ? void 0 : _c.replace(/(?:```)([^```]*)(?:```)/gm, "<tt>$1</tt> ");
    }
    else {
        return str;
    }
};
exports.wrap = wrap;
